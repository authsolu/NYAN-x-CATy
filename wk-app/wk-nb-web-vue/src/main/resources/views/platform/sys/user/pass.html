<div id="passApp">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 class="modal-title">${msg['index.user.password']}</h4>
    </div>
    <div class="modal-body">
        <el-form :model="passForm" ref="passForm" :rules="passRules">
            <el-row>
                <el-form-item prop="oldPassword">
                    <el-input maxlength="20" placeholder="${msg['index.user.oldpass']}" v-model="passForm.oldPassword"
                              auto-complete="off" tabindex="1" type="password"></el-input>
                </el-form-item>
            </el-row>
            <el-row>
                <el-form-item prop="newPassword">
                    <el-input maxlength="20" placeholder="${msg['index.user.newpass']}" v-model="passForm.newPassword"
                              auto-complete="off" tabindex="2" type="password"></el-input>
                </el-form-item>
            </el-row>
            <el-row>
                <el-form-item prop="passwordAgain">
                    <el-input maxlength="20" placeholder="${msg['index.user.rightpass']}"
                              v-model="passForm.passwordAgain"
                              auto-complete="off" tabindex="3" type="password"></el-input>
                </el-form-item>
            </el-row>
        </el-form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">${msg['system.cancel']}</button>
        <button type="button" class="btn btn-primary" @click="doPass">${msg['system.confirm']}</button>
    </div>
</div>
<script type="text/javascript">
    new Vue({
        el: '#passApp',
        data: function () {
            var validatePass = (rule, value, callback) => {
                if (value !== this.passForm.newPassword) {
                    callback(new Error('两次输入密码不一致!'));
                } else {
                    callback();
                }
            };
            return {
                passForm: {
                    oldPassword:"",
                    newPassword:"",
                    passwordAgain:""
                },
                passRules: {
                    oldPassword: [
                        {required: true, message: '请输入旧密码', trigger: 'blur'}
                    ],
                    newPassword: [
                        {required: true, message: '请输入新密码', trigger: 'blur'},
                        {min: 3, max: 20, message: '密码长度必须是3-20位', trigger: 'change'}
                    ],
                    passwordAgain: [
                        {required: true, message: '请再次输入新密码', trigger: 'blur'},
                        {validator: validatePass, trigger: 'change'}
                    ]
                },
            }
        },
        methods: {
            doPass:function () {
                var self = this
                self.$refs["passForm"].validate(function (valid) {
                    if (valid) {
                        $.post(base+"/platform/sys/user/doChangePassword", self.passForm, function (data) {
                            if (data.code == 0) {
                                $('#homeDetail').modal('hide');
                                Toast.success(data.msg);
                            } else {
                                Toast.error(data.msg);
                            }
                        }, "json");
                    }
                });
            }
        }
    });
</script>
