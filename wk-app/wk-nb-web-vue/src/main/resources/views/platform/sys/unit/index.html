<!--#
layout("/layouts/platform.html"){
#-->
<div id="app" v-cloak>
    <el-row class="header navbar bg-white shadow">
        <div class="btn-group tool-button mt5">
            <el-button size="medium" @click="openAdd"><i class="ti-plus"></i> 新建单位</el-button>
        </div>
    </el-row>
    <el-row class="el-table-container">
        <el-table :data="tableData" style="width: 100%" :row-style="showTr" size="small"
                  :highlight-current-row="true">
            <el-table-column label="单位名称" header-align="center" prop="name"
                             width="200" :show-overflow-tooltip="true" align="left">
                <template scope="scope">
                    <span v-for="(space, levelIndex) in treeTablePath(scope.row.path)" class="ms-tree-space"></span>
                    <span v-if="treeTableIconShow(scope.row)" @click="treeTableToggle(scope.$index)" style="cursor: pointer">
                        <span v-if="!scope.row.hasChildren"
                              class="el-tree-node__expand-icon el-icon-caret-right" title="展开"></span>

                        <span v-if="scope.row.hasChildren"
                              class="el-tree-node__expand-icon el-icon-caret-right expanded" title="关闭"></span>
                    {{ scope.row.name }}
                    </span>
                    <span v-if="!treeTableIconShow(scope.row)">
                        {{ scope.row.name }}
                    </span>
                </template>
            </el-table-column>

            <el-table-column label="计划编码" header-align="center" prop="projectPlanCode"
                             width="240" :show-overflow-tooltip="true" align="center">
            </el-table-column>

            <el-table-column label="说明" header-align="center" prop="remark"
                             :show-overflow-tooltip="true" align="center">
            </el-table-column>
        </el-table>
    </el-row>
</div>
<script>
    new Vue({
        el: "#app",
        data: function () {
            return {
                addDialogVisible: false,
                editDialogVisible: false,
                tableData: [{
                    "children": ["e4f32697f1564dacb1eb1f41a43272aa"],
                    "id": "e4f32697f1564dacb1eb1f41a43272aa", "parentId": null, "projectPlanCode": "GD.DG.SSH",
                    "projectPlanId": "e4f32697f1564dacb1eb1f41a43272aa", "name": "AAA项目",
                    "projectPlanNum": "1", "projectPlanVersionType": "PROJECT_STRU",
                    "remark": "AAA测试项目", "hasChildren": true, "treeLevel": 1, "versionName": null,"path":"0001"
                },
                    {
                        "children": ["fd29a87af56146d5be06aca76859cd10", "fd29a87af56146d5be06aca76859cd10"],
                        "id": "fd29a87af56146d5be06aca76859cd10",
                        "parentId": "e4f32697f1564dacb1eb1f41a43272aa",
                        "projectPlanCode": "GD.DG.SSH.01",
                        "projectPlanId": "fd29a87af56146d5be06aca76859cd10",
                        "name": "一期",
                        "projectPlanNum": "1",
                        "projectPlanVersionType": "PROJECT_STRU",
                        "remark": "这是分期",
                        "hasChildren": true,
                        "treeLevel": 2,"path":"00010001"
                    },
                    {
                        "children": ["98cbea3a026140da86cc155988257263"],
                        "id": "98cbea3a026140da86cc155988257263",
                        "parentId": "fd29a87af56146d5be06aca76859cd10",
                        "projectPlanCode": "DG.DG.SSH.01.002",
                        "projectPlanId": "98cbea3a026140da86cc155988257263",
                        "name": "2组团",
                        "remark": "组团",
                        "templateType": "PROJECT_STRU",
                        "text": null,
                        "hasChildren": true,
                        "treeLevel": 3,"path":"000100010001"
                    },
                    {
                        "id": "a72f6a245d274386b4dd5ca0e5f9d386",
                        "parentProjectPlanId": null,
                        "parentId": "98cbea3a026140da86cc155988257263",
                        "planTypeName": "关键节点计划",
                        "projectPlanCode": "1505387810166",
                        "projectPlanId": "a72f6a245d274386b4dd5ca0e5f9d386",
                        "name": "松山湖项目.一期.2组团.关键节点计划(启动版V1)",
                        "remark": null,
                        "hasChildren": true,
                        "treeLevel": 4,"path":"0001000100010001"
                    },
                    {
                        "children": ["eec514a5b9da44c596c8dd2bc89291ae"],
                        "id": "eec514a5b9da44c596c8dd2bc89291ae",
                        "parentProjectPlanId": "0000",
                        "parentId": "fd29a87af56146d5be06aca76859cd10",
                        "projectPlanCode": "DG.DG.SSH.01.001",
                        "projectPlanId": "eec514a5b9da44c596c8dd2bc89291ae",
                        "name": "1组团",
                        "remark": "这是组团",
                        "hasChildren": true,
                        "treeLevel": 3,"path":"000100010002"
                    },
                    {
                        "children": null,
                        "id": "c7032975b5424ae79378ddcf41e7892e",
                        "parentId": "eec514a5b9da44c596c8dd2bc89291ae",
                        "planTypeName": "关键节点计划",
                        "projectPlanCode": "1505889842908",
                        "projectPlanId": "c7032975b5424ae79378ddcf41e7892e",
                        "name": "松山湖项目.一期.1组团.关键节点计划(启动版V1)",
                        "remark": null,
                        "hasChildren": true,
                        "treeLevel": 4,"path":"0001000100010002"
                    }],
                pageSize: 10,
                pageNumber: 1,
                pageOrderName: "",
                pageOrderBy: "",
                totalCount: 0,
                form: {}
            }
        },
        methods: {
            openAdd: function () {
                this.addDialogVisible = true;
                this.form = {};//打开新增窗口,表单先清空
            },
            treeTablePath:function(path){
                return path.length/4-1;
            },
            // 显示行
            showTr: function (row, index) {
                var parentIndex = this.tableData.findIndex(function (value) {
                    return value.id === row.row.parentId;
                });
                console.log(parentIndex);
                var show = (row.row.parentId ? (this.tableData[parentIndex].hasChildren && this.tableData[parentIndex]._show) : true);
                row.row._show = show;
                console.log(row.row);
                return show ? '' : 'display:none;'
            },
            // 展开下级
            treeTableToggle: function (trIndex) {
                console.log(trIndex)
                var record = this.tableData[trIndex];
                record.hasChildren = !record.hasChildren;
            },
            // 显示层级关系的空格和图标
            spaceIconShow(index) {
                if (index === 0) {
                    return true;
                }
                return false;
            },
            // 点击展开和关闭的时候，图标的切换
            treeTableIconShow(record) {
                if (record.children && record.children.length > 0) {
                    return true;
                }
                return false;
            }
        },
        created: function () {

        }
    });
</script>
<style scoped>
    .ms-tree-space {
        position: relative;
        top: 1px;
        display: inline-block;
        font-family: 'Glyphicons Halflings';
        font-style: normal;
        font-weight: 400;
        line-height: 1;
        width: 18px;
        height: 14px;
    }

    .ms-tree-space::before {
        content: ""
    }

    table td {
        line-height: 26px;
    }

    .el-table__expand-icon--expanded {
        -ms-transform: rotate(90deg);
        transform: rotate(90deg);
    }
</style>
<!--#
}
#-->